import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import r2_score

# 데이터 예제 (길어진 경우, 일부 데이터 생략)
data = np.array([
            [0, 28, 35.99762786853281, 125.98258379191876, 35.99512785853281,
             125.97787026191878, 600, 21, 2176],
            [1, 86, 36.01298758853281, 126.00438693191876, 36.00445698853281,
             126.00416261191876, 900, 12, 2680],
            [2, 118, 35.99107378853281, 126.02258034191878, 35.984552238532814,
             126.02973916191878, 600, 22, 2419],
            [3, 155, 36.02109802853281, 126.01932979191878, 36.01653699853281,
             126.01903011191878, 600, 44, 2303],
            [4, 156, 36.01815307853281, 125.97202862191878, 36.017554798532814,
             125.98698865191878, 900, 16, 2882],
            [5, 174, 36.02620782853281, 125.97919441191878, 36.00715406853281,
             125.98648668191878, 900, 18, 3189],
            [6, 199, 35.982268788532814, 125.99613855191878, 35.98603941853281,
             125.99669081191878, 900, 22, 2619],
            [7, 253, 35.99174072853281, 126.04216187191878, 35.98844734853281,
             126.04203325191878, 900, 17, 2654],
            [8, 299, 35.99701774853281, 126.03391247191878, 35.99975430853281,
             126.03822516191876, 600, 18, 2442],
            [9, 304, 36.01432026853281, 125.97658387191878, 36.01391823853281,
             125.99415166191878, 900, 11, 3107],
            [10, 324, 35.99637797853281, 125.98047291191878, 36.00304638853281,
             125.98906896191878, 900, 15, 2959],
            [11, 351, 35.99948887853281, 125.98863874191878, 36.00008080853281,
             125.98418434191878, 600, 30, 2465],
            [12, 371, 35.99940527853281, 125.97358456191878, 36.00234063853281,
             125.96103896191876, 300, 37, 2440],
            [13, 374, 36.01414392853281, 125.97396655191878, 36.01774092853281,
             125.99648603191878, 600, 14, 3038],
            [14, 380, 36.00579367853281, 125.98749978191876, 35.99743010853281,
             125.99752543191876, 1200, 84, 3389],
            [15, 406, 35.99561360853281, 125.98789965191878, 35.99019320853281,
             125.99253440191876, 900, 16, 2929],
            [16, 446, 35.99871094853281, 125.97527887191876, 36.00141430853281,
             125.99512769191878, 1500, 20, 3926],
            [17, 446, 35.98979621853281, 126.02546900191878, 35.99015792853281,
             126.02259342191876, 600, 16, 2513],
            [18, 492, 35.99671236853281, 126.04146735191878, 35.99025306853281,
             126.03437239191878, 900, 18, 3090],
            [19, 553, 35.99029492853281, 125.95658637191876, 36.00117807853281,
             125.97643906191878, 600, 32, 3247],
            [20, 558, 35.99418401853281, 125.99305516191878, 35.98742137853281,
             125.99118289191878, 900, 32, 3093],
            [21, 626, 35.99718327853281, 125.97136261191878, 35.99744828853281,
             125.98909219191876, 900, 27, 3434],
            [22, 645, 35.98601811853281, 125.98280632191876, 36.00089065853281,
             125.97514105191878, 300, 25, 2918],
            [23, 655, 35.99568374853281, 125.98788892191878, 35.99120047853281,
             125.99340524191878, 900, 24, 3168],
            [24, 656, 35.99615577853281, 125.98030626191878, 35.97935262853281,
             125.98491630191876, 1200, 19, 3870],
            [25, 657, 35.99962847853281, 126.02957946191876, 35.99135808853281,
             126.03385859191876, 1500, 39, 3867],
            [26, 657, 36.01307046853281, 125.97933365191878, 36.00516409853281,
             125.96998367191878, 1200, 90, 3640],
            [27, 679, 35.99157245853281, 125.95092018191878, 35.98825620853281,
             125.96722401191876, 1200, 24, 3760],
            [28, 679, 35.99671143853281, 125.98958318191876, 36.00121156853281,
             125.99199851191878, 300, 16, 2540],
            [29, 752, 35.99546181853281, 126.00305421191878, 36.00093118853281,
             126.00738315191876, 600, 36, 2971],
            [30, 784, 35.993739528532814, 125.98805563191878, 35.97475632853281,
             125.99009358191876, 900, 26, 3766],
            [31, 810, 35.99798952853281, 126.01549745191878, 36.00355542853281,
             126.01461373191876, 1800, 33, 4197],
            [32, 835, 35.99515602853281, 125.98744453191878, 36.00323587853281,
             125.98564805191876, 900, 24, 3417],
            [33, 850, 35.98449046853281, 125.98002884191878, 36.00340566853281,
             125.98641555191878, 900, 16, 3852],
            [34, 884, 35.99665589853281, 125.99030534191878, 35.98804904853281,
             125.98866831191876, 900, 18, 3485],
            [35, 979, 35.99865561853281, 125.98752776191878, 36.00055707853281,
             125.99338088191878, 900, 23, 3447],
            [36, 981, 36.03381826853281, 125.99119310191878, 36.021517038532814,
             126.00562631191876, 1200, 25, 4185],
            [37, 1035, 35.97486792853281, 125.97932723191876, 35.99190048853281,
             125.99054529191878, 900, 21, 4026],
            [38, 1079, 36.00046070853281, 125.97333456191878, 35.99414996853281,
             125.98710450191878, 600, 11, 3530],
            [39, 1085, 35.99190699853281, 126.02063604191878, 35.99093081853281,
             126.02409817191878, 600, 15, 3174],
            [40, 1102, 35.99698907853281, 125.98394480191878, 36.01311339853281,
             125.98260012191878, 1200, 19, 4277],
            [41, 1108, 36.01079337853281, 126.00308156191878, 36.01464410853281,
             126.00485904191878, 900, 21, 3539],
            [42, 1120, 35.99326736853281, 125.98830562191878, 36.00144159853281,
             126.00991184191878, 600, 22, 3810],
            [43, 1120, 35.99312893853281, 126.01308114191878, 35.99848250853281,
             126.01911446191878, 900, 16, 3667],
            [44, 1127, 36.03405463853281, 125.99076192191878, 36.02461512853281,
             125.99385581191878, 600, 36, 3467],
            [45, 1154, 36.00037738853281, 125.97339011191876, 36.01207063853281,
             125.98743815191878, 900, 16, 4034],
            [46, 1278, 36.00532144853281, 125.98402789191876, 36.00186747853281,
             125.98911866191878, 600, 14, 3456],
            [47, 1288, 35.99090669853281, 125.99755484191876, 35.99240669853281,
             126.00803836191878, 300, 21, 3285],
            [48, 1365, 35.99440658853281, 126.01424767191878, 35.99029409853281,
             126.01680606191876, 900, 18, 3815],
            [49, 1375, 35.99546181853281, 126.00305421191878, 35.98408558853281,
             126.00742896191878, 900, 25, 4094],
            [50, 1414, 35.99898981853281, 126.03830090191876, 35.98502139853281,
             126.03915014191878, 900, 20, 4209],
            [51, 1441, 36.03351269853281, 125.98836003191876, 36.02994319853281,
             125.99780411191878, 300, 24, 3431],
            [52, 1531, 36.00312826853281, 126.04066168191878, 35.99696311853281,
             126.03693804191876, 1200, 16, 4364],
            [53, 1563, 35.99598930853281, 125.99011093191878, 36.00174100853281,
             125.99654349191876, 600, 14, 3829],
            [54, 1624, 35.99760051853281, 126.00627608191878, 35.99696228853281,
             126.00476641191878, 900, 30, 3955],
            [55, 1630, 35.98749992853281, 126.02681823191878, 35.98611140853281,
             126.03242375191876, 900, 19, 4085],
            [56, 1722, 36.02146292853281, 126.01930933191878, 36.01480164853281,
             126.01248453191876, 900, 20, 4320],
            [57, 1801, 35.99937751853281, 125.97433449191878,
             36.001320848532814, 125.96292794191878, 1200, 24, 4728],
            [58, 1838, 35.99732245853281, 125.98872213191878, 35.99649990853281,
             125.98941903191876, 600, 22, 3855],
            [59, 1861, 35.99358292853281, 126.00157023191878,
             35.991921958532814, 125.99937210191878, 900, 20, 4231],
            [60, 1912, 36.02631951853281, 126.01219140191878, 36.02405880853281,
             126.01472922191876, 900, 22, 4304],
            [61, 1917, 36.01309842853281, 125.98994380191878, 36.00930891853281,
             125.99896348191878, 900, 21, 4500],
            [62, 1974, 36.00526591853281, 125.98491670191878, 35.99604194853281,
             125.98751375191878, 600, 10, 4302],
            [63, 2168, 35.98290755853281, 125.99344433191878, 35.97663603853281,
             125.99833687191878, 900, 12, 4721],
            [64, 2210, 35.99440644853281, 126.00610952191876, 35.99451140853281,
             126.01738266191876, 900, 17, 4826],
            [65, 2304, 36.02720819853281, 126.00666410191876, 36.02964657853281,
             126.01223645191878, 900, 28, 4773],
            [66, 2314, 35.99885095853281, 126.03882864191878, 35.99441822853281,
             126.03837601191876, 900, 20, 4758],
            [67, 2402, 35.99718327853281, 125.97136261191878, 36.00379367853281,
             125.97942532191878, 600, 18, 4724],
            [68, 2501, 36.01179311853281, 125.99536001191878, 36.00543282853281,
             125.99645402191878, 1200, 18, 5317],
            [69, 2524, 35.99734978853281, 125.96339110191876, 35.98710435853281,
             125.97367640191878, 600, 88, 4990],
            [70, 2571, 36.01914892853281, 126.01326323191876, 36.01677753853281,
             126.00999080191878, 600, 13, 4682],
            [71, 2589, 36.00237822853281, 126.03338459191878, 36.00100420853281,
             126.03088947191878, 900, 22, 4959],
            [72, 2710, 35.998572298532814, 125.98741666191876,
             35.99638758853281, 125.98304428191878, 900, 15, 5143],
            [73, 2715, 35.99196173853281, 125.97541794191878, 36.00264486853281,
             125.97616278191876, 600, 10, 5089],
            [74, 2792, 35.99618391853281, 126.00063774191878, 36.00374797853281,
             126.00921170191876, 900, 14, 5450],
            [75, 2798, 36.00418274853281, 125.98727763191876, 35.99762214853281,
             125.99430975191878, 900, 18, 5398],
            [76, 2823, 35.99396198853281, 126.00238765191878, 35.99048553853281,
             126.00909963191876, 900, 16, 5340],
            [77, 2890, 35.99190699853281, 126.02063604191878, 35.98682688853281,
             126.01969399191876, 600, 30, 5059],
            [78, 2947, 36.00104393853281, 125.97094587191876, 35.99419507853281,
             125.97397814191878, 1800, 36, 6395],
            [79, 2962, 36.001239008532814, 126.00730366191878,
             35.99978001853281, 126.00086507191878, 1500, 33, 6041],
            [80, 2979, 35.99190699853281, 126.02063604191878, 35.98521678853281,
             126.02066161191878, 600, 13, 5205],
            [81, 3006, 35.99887799853281, 125.99763794191878, 36.00327794853281,
             125.99472294191878, 900, 15, 5470],
            [82, 3101, 36.01293160853281, 125.97997249191876, 36.00919180853281,
             125.98613998191878, 300, 18, 5011],
            [83, 3128, 35.99675482853281, 125.96480803191878, 35.98437358853281,
             125.96703211191878, 900, 55, 5869],
            [84, 3136, 35.99626683853281, 125.97822312191876, 36.00108729853281,
             125.97996382191876, 1800, 55, 6501],
            [85, 3226, 36.00043339853281, 125.99913776191876, 35.99684165853281,
             126.00916601191878, 1200, 28, 6133],
            [86, 3265, 35.99810058853281, 126.01316433191876, 35.99470357853281,
             126.01624684191876, 600, 18, 5400],
            [87, 3267, 35.99901670853281, 125.98849988191878, 35.99721778853281,
             125.99341879191876, 1800, 38, 6608],
            [88, 3267, 35.99826676853281, 125.98730557191878, 35.99702760853281,
             125.98527595191878, 1500, 40, 6223],
            [89, 3284, 35.99234735853281, 126.00110022191878, 35.99396955853281,
             126.00644836191876, 600, 28, 5434],
            [90, 3322, 35.99696112853281, 125.97402904191878, 36.00033715853281,
             125.97511628191876, 900, 16, 5731],
            [91, 3347, 36.00123861853281, 125.98561119191878, 36.01373452853281,
             125.98052165191878, 900, 22, 6111],
            [92, 3354, 35.99960012853281, 125.99724907191876, 36.01313186853281,
             125.99548259191876, 600, 18, 5835],
            [93, 3452, 35.99785061853281, 126.01324766191878, 35.99759973853281,
             126.01449467191878, 600, 20, 5470],
            [94, 3454, 35.99829454853281, 125.98763887191878,
             35.984746488532814, 125.99734760191878, 900, 28, 6311],
            [95, 3466, 35.991850938532814, 125.99247194191878,
             35.98803130853281, 125.99368804191876, 600, 13, 5591],
            [96, 3474, 36.01654259853281, 125.99663754191876, 36.01856655853281,
             125.99828886191878, 900, 28, 5843],
            [97, 3493, 35.99004644853281, 126.04007877191876, 35.98845522853281,
             126.04801830191876, 600, 27, 5717],
            [98, 3496, 36.00125974853281, 126.00498777191878, 35.99927377853281,
             126.01036690191876, 1200, 33, 6252],
            [99, 3513, 36.01784770853281, 125.98058341191876, 36.01827214853281,
             125.98052884191878, 1200, 15, 6109]
])

# 데이터 전처리
X = data[:, 2:]  # 클러스터링에 사용할 특성만 추출
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# 군집 개수의 범위 정의
k_range = range(1, 20)  # 군집 개수를 1부터 10까지 테스트

r2_scores = []

for k in k_range:
    kmeans = KMeans(n_clusters=k, random_state=0)
    kmeans.fit(X_scaled)
    labels = kmeans.labels_
    centers = kmeans.cluster_centers_
    
    # 클러스터링 결과로부터 각 클러스터의 데이터 점과 중심 간의 거리 계산
    distances = np.zeros(X_scaled.shape[0])
    for i in range(k):
        cluster_points = X_scaled[labels == i]
        cluster_center = centers[i]
        distances[labels == i] = np.linalg.norm(cluster_points - cluster_center, axis=1)
    
    # 각 클러스터에 대한 R^2 값 계산
    mean_distance = np.mean(distances)
    total_distance = np.sum((X_scaled - np.mean(X_scaled, axis=0)) ** 2)
    r2 = 1 - (np.sum(distances ** 2) / total_distance)
    r2_scores.append(r2)

# 결과 시각화
plt.figure(figsize=(10, 6))
plt.plot(k_range, r2_scores, marker='o', linestyle='-', color='b')
plt.xlabel('Number of Clusters')
plt.ylabel('R-squared')
plt.title('Elbow Method for Optimal Number of Clusters (R-squared)')
plt.xticks(k_range)
plt.grid(True)
plt.show()
